<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Authenctication - Historypin API</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../index.html">Historypin API</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../../index.html">Home</a>
                </li>
            
            
            
                <li class="active">
                    <a href="index.html">Authenctication</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Items <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../items/details/index.html">Details</a>
</li>

                    
                        
<li >
    <a href="../../items/gallery/index.html">Gallery</a>
</li>

                    
                        
<li >
    <a href="../../items/map/index.html">Map</a>
</li>

                    
                        
<li >
    <a href="../../items/pinner/index.html">Pinner (w)</a>
</li>

                    
                        
<li >
    <a href="../../items/delete/index.html">Delete (w)</a>
</li>

                    
                        
<li >
    <a href="../../items/comments/index.html">Comments</a>
</li>

                    
                        
<li >
    <a href="../../items/comments-post/index.html">Post Comment</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../users/details/index.html">Details</a>
</li>

                    
                        
<li >
    <a href="../../users/edit/index.html">Edit (w)</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Collections <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../collections/details/index.html">Details</a>
</li>

                    
                        
<li >
    <a href="../../collections/rss/index.html">RSS</a>
</li>

                    
                        
<li >
    <a href="../../collections/community_posts/index.html">Community Posts</a>
</li>

                    
                        
<li >
    <a href="../../collections/save/index.html">Save (w)</a>
</li>

                    
                        
<li >
    <a href="../../collections/delete/index.html">Delete (w)</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Places <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../places/details/index.html">Details</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../listings/index.html">Listings</a>
                </li>
            
            
            
                <li >
                    <a href="../../bulk/index.html">Bulk Uploaders</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../../index.html">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../items/details/index.html">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#authentication">Authentication</a></li>
        
            <li><a href="#api-endpoint">API Endpoint</a></li>
        
            <li><a href="#api-pair-and-token">API Pair and Token</a></li>
        
            <li><a href="#api-key">API Key</a></li>
        
            <li><a href="#api-shared-secret">API Shared Secret</a></li>
        
            <li><a href="#get-your-api-keys">Get your API keys</a></li>
        
            <li><a href="#api-token">API Token</a></li>
        
            <li><a href="#sending-requests">Sending Requests</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="authentication">Authentication</h1>
<p>Authentication is needed if you want to be able to do an API write operation, like edit a user's profile information or upload an item (pin) for example.</p>
<h2 id="api-endpoint">API Endpoint</h2>
<p><a href="https://www.historypin.org/en/api/">https://www.historypin.org/en/api/</a></p>
<h2 id="api-pair-and-token">API Pair and Token</h2>
<p>The API Pair is a combination of user's API key and user's API shared secret. Currently this is the only way to authenticate through the API programatically.</p>
<h2 id="api-key">API Key</h2>
<p>The API key is a 64 character string randomly generated for user's account.</p>
<h3 id="example">Example</h3>
<pre><code class="python">API_KEY = 'e519f7e8481e2002f9874cf10ac19bfca533704746d02b98ee9f9f6baa3231d8'
</code></pre>

<h2 id="api-shared-secret">API Shared Secret</h2>
<p>The API shared secret is a 32 character string randomly generated for user's account.</p>
<h3 id="example_1">Example</h3>
<pre><code class="python">API_SECRET = '4a37d542252bd03300a8e79131f9624c'
</code></pre>

<p><span style="color: darkred;"><strong>NOTE: This string MUST be kept secret at all times otherwise it will compromise user's security. It must be used ONLY when generating the API Token</strong></span></p>
<h2 id="get-your-api-keys">Get your API keys</h2>
<p>API Keys can be taken from user's profile edit view in the section "API Settings" at the bottom of the page.</p>
<p>If the fields are empty, the API pair can be generated by clicking "Generate API Pair"</p>
<h2 id="api-token">API Token</h2>
<p>The API Token is a hash that validates the user sending the request.</p>
<p>It is generated by concatenating all request path and request data in specific way. First all key and values are concatenated into a pair with <code>=</code>. then all pairs are ordered alphabetically and concatenated with <code>&amp;</code>.</p>
<h3 id="example_2">Example</h3>
<h4 id="request-data-path">Request Data, Path:</h4>
<p>Request data consists of data send through query string and post data <!-- and files -->.</p>
<pre><code class="python">api_path = 'user/get_edit.json'

data = {
    'id'              : 19,
    'example_variable': 123,
    'api_key'         : 'e519f7e8481e2002f9874cf10ac19bfca533704746d02b98ee9f9f6baa3231d8',
}
</code></pre>

<h4 id="concatenate-key-and-value-order-alphabetically">Concatenate key and value. Order alphabetically</h4>
<pre><code class="python">data = [
    'api_key=e519f7e8481e2002f9874cf10ac19bfca533704746d02b98ee9f9f6baa3231d8',
    'api_path=user/get_edit.json',
    'example_variable=123',
    'id=19',
]
</code></pre>

<h4 id="concatenate-pairs">Concatenate pairs</h4>
<pre><code class="python">BODY = 'api_key=e519f7e8481e2002f9874cf10ac19bfca533704746d02b98ee9f9f6baa3231d8&amp;api_path=user/get_edit.json&amp;example_variable=123&amp;id=19'
</code></pre>

<h4 id="generate-token">Generate Token</h4>
<p>For the token generation we use HMAC with SHA256 as digest module and the shared secret is our crypto key. After that the API Token is send with the request variables as get argument.</p>
<pre><code class="python">api_token = hmac.new(API_SECRET), BODY, hashlib.sha256).hexdigest()
api_token = '0083a327ee8f63e9f57829dc58214bd63a078c7fcd69f369d54e4fd28a7df7d3' # Example Token
</code></pre>

<h4 id="code-example">Code Example</h4>
<pre><code class="python">import hmac, hashlib
from collections import OrderedDict

API_SECRET = '4a37d542252bd03300a8e79131f9624c'

data = {
    'id'              : 19,
    'example_variable': 123,
    'api_key'         : 'e519f7e8481e2002f9874cf10ac19bfca533704746d02b98ee9f9f6baa3231d8',
    'api_path'        : 'user/get_edit.json',
}

BODY = '&amp;'.join(['{}={}'.format(k, v) for k, v in OrderedDict(sorted(data.items() + postdata.items())).items()])

api_token = hmac.new(API_SECRET, BODY, hashlib.sha256).hexdigest()

</code></pre>

<h2 id="sending-requests">Sending Requests</h2>
<h4 id="code-example">Code Example</h4>
<pre><code class="python"> import hmac, hashlib, requests
from collections import OrderedDict

from requests.api import post

def api_call(path, querydata = {}, postdata = {}, api_key = '', api_secret = ''):
    BASE = 'https://www.historypin.org/en/api/'

    querydata['api_key'] = api_key
    BODY = '&'.join(['{}={}'.format(k, v) for k, v in OrderedDict(sorted(querydata.items() + postdata.items() + [('api_path', path)])).items()])
    api_token = hmac.new(api_secret, BODY, hashlib.sha256).hexdigest()
    querystring = '&'.join(['{}={}'.format(k, v) for k, v in querydata.items()])
    url = '{}{}?{}&api_token={}'.format(BASE, path, querystring, api_token)

    return requests.post(url, data = postdata)


response = api_call(
    path = 'comments/post.json',
    postdata = {
        'item_id' : 1089880,
        'copy': 'lorem ipsum dolor cit amet...',
    },
    api_key = 'e519f7e848189b352f7d8231e907bcb1b7e4360f1898d740f62b9fe041e61481',
    api_secret = 'd883a3e32a7865c088ed2d97d1896e32',
)

print(response.content)
</code></pre>
		    
	</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
